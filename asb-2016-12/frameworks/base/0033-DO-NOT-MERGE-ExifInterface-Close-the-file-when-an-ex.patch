From 82f36d83fe09cbb8bc6fa9f7667bd8b1148a1b7d Mon Sep 17 00:00:00 2001
From: Sungsoo <sungsoo@google.com>
Date: Tue, 18 Oct 2016 14:12:00 +0900
Subject: [PATCH 33/46] DO NOT MERGE) ExifInterface: Close the file when an
 exception happens

Bug: 32068647, Bug: 30936376
Change-Id: I22fa2384348c890ca726d2b1632cd54e59d25a8f
(cherry picked from commit 418e0869ba936ff1e1d31f576021d15e8da6a105)
---
 media/java/android/media/ExifInterface.java | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/media/java/android/media/ExifInterface.java b/media/java/android/media/ExifInterface.java
index d51dbda..a561525 100644
--- a/media/java/android/media/ExifInterface.java
+++ b/media/java/android/media/ExifInterface.java
@@ -1330,8 +1330,9 @@ public class ExifInterface {
         for (int i = 0; i < EXIF_TAGS.length; ++i) {
             mAttributes[i] = new HashMap();
         }
+        InputStream in = null;
         try {
-            InputStream in = new FileInputStream(mFilename);
+            in = new FileInputStream(mFilename);
             getJpegAttributes(in);
             mIsSupportedFile = true;
         } catch (IOException e) {
@@ -1344,6 +1345,7 @@ public class ExifInterface {
             if (DEBUG) {
                 printAttributes();
             }
+            IoUtils.closeQuietly(in);
         }
     }
 
-- 
2.7.4

