From f45029ea056b6e6eac7fc4149427d6a57bdd1ccf Mon Sep 17 00:00:00 2001
From: Robert Shih <robertshih@google.com>
Date: Fri, 11 Mar 2016 18:33:51 -0800
Subject: [PATCH 1/2] Avoid free-before-initialize vulnerability in heap

Bug: 27211885
Change-Id: Ib9c93bd9ffdde2a5f8d31a86f06e267dc9c152db
(cherry picked from commit 6995c8473ccfc43848e179a060de8157d7d897c5)
---
 libFLAC/stream_decoder.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/libFLAC/stream_decoder.c b/libFLAC/stream_decoder.c
index 916fde6..a195f79 100644
--- a/libFLAC/stream_decoder.c
+++ b/libFLAC/stream_decoder.c
@@ -1744,6 +1744,7 @@ FLAC__bool read_metadata_vorbiscomment_(FLAC__StreamDecoder *decoder, FLAC__Stre
 	if(obj->num_comments > 0) {
 		if(0 == (obj->comments = (FLAC__StreamMetadata_VorbisComment_Entry*)safe_malloc_mul_2op_(obj->num_comments, /*times*/sizeof(FLAC__StreamMetadata_VorbisComment_Entry)))) {
 			decoder->protected_->state = FLAC__STREAM_DECODER_MEMORY_ALLOCATION_ERROR;
+			obj->num_comments = 0;
 			return false;
 		}
 		for(i = 0; i < obj->num_comments; i++) {
-- 
2.7.4

