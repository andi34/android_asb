From 6b408ee56bb59c0b69340ed866d19e761c59dc31 Mon Sep 17 00:00:00 2001
From: "Dr. Stephen Henson" <steve@openssl.org>
Date: Tue, 13 May 2014 18:48:31 +0100
Subject: [PATCH 04/16] Fix for CVE-2014-0195
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

A buffer overrun attack can be triggered by sending invalid DTLS fragments
to an OpenSSL DTLS client or server. This is potentially exploitable to
run arbitrary code on a vulnerable client or server.

Fixed by adding consistency check for DTLS fragments.

Thanks to JÃ¼ri Aedla for reporting this issue.
(cherry picked from commit 1632ef744872edc2aa2a53d487d3e79c965a4ad3)

Change-Id: Ie0b8939a71a6772616822df643f2168954b991ad
---
 ssl/d1_both.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/ssl/d1_both.c b/ssl/d1_both.c
index 11ab753..9a250fd 100644
--- a/ssl/d1_both.c
+++ b/ssl/d1_both.c
@@ -620,7 +620,16 @@ dtls1_reassemble_fragment(SSL *s, struct hm_header_st* msg_hdr, int *ok)
 		frag->msg_header.frag_off = 0;
 		}
 	else
+		{
 		frag = (hm_fragment*) item->data;
+		if (frag->msg_header.msg_len != msg_hdr->msg_len)
+			{
+			item = NULL;
+			frag = NULL;
+			goto err;
+			}
+		}
+
 
 	/* If message is already reassembled, this must be a
 	 * retransmit and can be dropped.
-- 
2.7.4

