From 06b35c20411df3f2a57f8ce3d40beeaa85231791 Mon Sep 17 00:00:00 2001
From: Jack Yu <jackcwyu@google.com>
Date: Fri, 1 Feb 2019 15:58:05 -0800
Subject: [PATCH 4/5] Merge "Prevent OOB error in rw_i93_sm_read_ndef()" into
 oc-dev am: 46f44fd653 am: e010bdd3de am: e079b7a95a

Change-Id: I6e24e6eca85a59767f5227755389e63b32ad1254
(cherry picked from commit baa27d0bcc73012684fab286c52a0830f0f1ccb3)
---
 src/nfc/tags/rw_i93.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/src/nfc/tags/rw_i93.c b/src/nfc/tags/rw_i93.c
index b1b5638..4713d8f 100644
--- a/src/nfc/tags/rw_i93.c
+++ b/src/nfc/tags/rw_i93.c
@@ -23,6 +23,7 @@
  *  mode.
  *
  ******************************************************************************/
+#include <log/log.h>
 #include <string.h>
 #include "nfc_target.h"
 #include "bt_types.h"
@@ -1996,6 +1997,13 @@ void rw_i93_sm_read_ndef (BT_HDR *p_resp)
 
     RW_TRACE_DEBUG0 ("rw_i93_sm_read_ndef ()");
 
+    if (length == 0)
+    {
+        android_errorWriteLog(0x534e4554, "122035770");
+        rw_i93_handle_error(NFC_STATUS_FAILED);
+        return;
+    }
+
     STREAM_TO_UINT8 (flags, p);
     length--;
 
-- 
2.7.4

