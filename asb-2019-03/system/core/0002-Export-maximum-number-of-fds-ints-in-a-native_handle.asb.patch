From 3e4e3e45ae171f0cd3ab2b266d162afa2d22f380 Mon Sep 17 00:00:00 2001
From: Martijn Coenen <maco@google.com>
Date: Wed, 5 Dec 2018 09:42:25 +0100
Subject: [PATCH 2/2] Export maximum number of fds/ints in a native_handle.

So we can deserialize it consisently and safely.

Bug: 120084106
Test: builds
Change-Id: I0eafff70d3a7e4d732fe600a0052efb90108208d
---
 include/cutils/native_handle.h | 3 +++
 libcutils/native_handle.c      | 6 ++----
 2 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/include/cutils/native_handle.h b/include/cutils/native_handle.h
index 268c5d3..2c957b2 100644
--- a/include/cutils/native_handle.h
+++ b/include/cutils/native_handle.h
@@ -21,6 +21,9 @@
 extern "C" {
 #endif
 
+#define NATIVE_HANDLE_MAX_FDS 1024
+#define NATIVE_HANDLE_MAX_INTS 1024
+
 typedef struct native_handle
 {
     int version;        /* sizeof(native_handle_t) */
diff --git a/libcutils/native_handle.c b/libcutils/native_handle.c
index 61fa38e..af15c7d 100644
--- a/libcutils/native_handle.c
+++ b/libcutils/native_handle.c
@@ -25,12 +25,10 @@
 #include <cutils/log.h>
 #include <cutils/native_handle.h>
 
-static const int kMaxNativeFds = 1024;
-static const int kMaxNativeInts = 1024;
-
 native_handle_t* native_handle_create(int numFds, int numInts)
 {
-    if (numFds < 0 || numInts < 0 || numFds > kMaxNativeFds || numInts > kMaxNativeInts) {
+    if (numFds < 0 || numInts < 0 || numFds > NATIVE_HANDLE_MAX_FDS ||
+        numInts > NATIVE_HANDLE_MAX_INTS) {
         return NULL;
     }
 
-- 
2.7.4

